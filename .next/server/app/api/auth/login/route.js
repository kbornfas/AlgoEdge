"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},45802:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>x,requestAsyncStorage:()=>w,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{POST:()=>m});var n=r(49303),s=r(88716),i=r(60670),o=r(87070),u=r(20728),p=r(95456),l=r(91585),d=r(26033);let c=l.Ry({email:l.Z_().email(),password:l.Z_().min(1),twoFactorCode:l.Z_().optional()});async function m(e){try{let t=await e.json(),a=c.parse(t),n=await u._.user.findUnique({where:{email:a.email}});if(!n||!await (0,p.Oe)(a.password,n.passwordHash))return o.NextResponse.json({error:"Invalid email or password"},{status:401});if(n.twoFaEnabled){if(!a.twoFactorCode)return o.NextResponse.json({error:"Two-factor authentication required",requires2FA:!0},{status:403});let{verifyTwoFactorToken:e}=await Promise.all([r.e(3748),r.e(1423)]).then(r.bind(r,61423));if(!e(a.twoFactorCode,n.twoFaSecret))return o.NextResponse.json({error:"Invalid two-factor authentication code"},{status:401})}if("rejected"===n.approvalStatus)return o.NextResponse.json({error:n.rejectionReason||"Account has been rejected by admin. Please contact support.",isRejected:!0},{status:403});if(!n.isActivated||"approved"!==n.approvalStatus)return o.NextResponse.json({error:"Account not activated. Please complete email verification, submit payment proof, and wait for admin approval.",requiresActivation:!0,paymentStatus:n.paymentStatus,approvalStatus:n.approvalStatus,isVerified:n.isVerified},{status:403});await u._.user.update({where:{id:n.id},data:{lastLogin:new Date}});let s=(0,p.RA)({userId:n.id,email:n.email,username:n.username}),i=await u._.subscription.findUnique({where:{userId:n.id}});return o.NextResponse.json({message:"Login successful",token:s,user:{id:n.id,username:n.username,email:n.email,fullName:n.fullName,isVerified:n.isVerified,isActivated:n.isActivated,twoFaEnabled:n.twoFaEnabled,paymentStatus:n.paymentStatus,subscription:i?{plan:i.plan,status:i.status}:null}})}catch(e){if(console.error("Login error:",e),e instanceof d.jm)return o.NextResponse.json({error:"Invalid input data",details:e.errors},{status:400});return o.NextResponse.json({error:"Login failed. Please try again."},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/home/runner/work/AlgoEdge/AlgoEdge/src/app/api/auth/login/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:w,staticGenerationAsyncStorage:g,serverHooks:h}=f,v="/api/auth/login/route";function x(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},95456:(e,t,r)=>{r.d(t,{Oe:()=>f,RA:()=>d,VV:()=>w,WX:()=>c,c_:()=>m,f:()=>g});var a=r(41482),n=r.n(a),s=r(42023),i=r.n(s),o=r(84770),u=r.n(o);let p=process.env.JWT_SECRET;p||console.warn("⚠️  JWT_SECRET not set. Using development fallback. DO NOT use in production!");let l=p||"dev-only-secret-DO-NOT-USE-IN-PRODUCTION";function d(e){return n().sign(e,l,{expiresIn:"7d"})}function c(e){try{return n().verify(e,l)}catch(e){return null}}async function m(e){let t=await i().genSalt(12);return i().hash(e,t)}async function f(e,t){return i().compare(e,t)}function w(e=32){return u().randomBytes(e).toString("hex")}function g(e=6){let t=Math.pow(10,e-1);return(t+u().randomBytes(4).readUInt32BE(0)%(Math.pow(10,e)-1-t+1)).toString()}},20728:(e,t,r)=>{r.d(t,{_:()=>n});let a=require("@prisma/client"),n=global.prisma||new a.PrismaClient({log:["error"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,6944,1585],()=>r(45802));module.exports=a})();