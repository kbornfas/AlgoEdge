"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},45802:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>q,requestAsyncStorage:()=>w,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var a={};t.r(a),t.d(a,{POST:()=>m});var n=t(49303),i=t(88716),o=t(60670),s=t(87070),u=t(20728),l=t(95456),p=t(91585),d=t(26033);let c=p.Ry({email:p.Z_().email(),password:p.Z_().min(1),twoFactorCode:p.Z_().optional()});async function m(e){try{let r=await e.json(),a=c.parse(r),n=await u._.user.findUnique({where:{email:a.email}});if(!n||!await (0,l.Oe)(a.password,n.passwordHash))return s.NextResponse.json({error:"Invalid email or password"},{status:401});if(n.twoFaEnabled){if(!a.twoFactorCode)return s.NextResponse.json({error:"Two-factor authentication required",requires2FA:!0},{status:403});let{verifyTwoFactorToken:e}=await Promise.all([t.e(748),t.e(423)]).then(t.bind(t,61423));if(!e(a.twoFactorCode,n.twoFaSecret))return s.NextResponse.json({error:"Invalid two-factor authentication code"},{status:401})}await u._.user.update({where:{id:n.id},data:{lastLogin:new Date}});let i=(0,l.RA)({userId:n.id,email:n.email,username:n.username}),o=await u._.subscription.findUnique({where:{userId:n.id}});return s.NextResponse.json({message:"Login successful",token:i,user:{id:n.id,username:n.username,email:n.email,fullName:n.fullName,isVerified:n.isVerified,twoFaEnabled:n.twoFaEnabled,subscription:o?{plan:o.plan,status:o.status}:null}})}catch(e){if(console.error("Login error:",e),e instanceof d.jm)return s.NextResponse.json({error:"Invalid input data",details:e.errors},{status:400});return s.NextResponse.json({error:"Login failed. Please try again."},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/home/runner/work/AlgoEdge/AlgoEdge/src/app/api/auth/login/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:w,staticGenerationAsyncStorage:g,serverHooks:h}=f,x="/api/auth/login/route";function q(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},95456:(e,r,t)=>{t.d(r,{Oe:()=>f,RA:()=>d,VV:()=>w,WX:()=>c,c_:()=>m});var a=t(41482),n=t.n(a),i=t(42023),o=t.n(i),s=t(84770),u=t.n(s);let l=process.env.JWT_SECRET;l||console.warn("⚠️  JWT_SECRET not set. Using development fallback. DO NOT use in production!");let p=l||"dev-only-secret-DO-NOT-USE-IN-PRODUCTION";function d(e){return n().sign(e,p,{expiresIn:"7d"})}function c(e){try{return n().verify(e,p)}catch(e){return null}}async function m(e){let r=await o().genSalt(12);return o().hash(e,r)}async function f(e,r){return o().compare(e,r)}function w(e=32){return u().randomBytes(e).toString("hex")}},20728:(e,r,t)=>{t.d(r,{_:()=>n});let a=require("@prisma/client"),n=global.prisma||new a.PrismaClient({log:["error"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[948,972,944,585],()=>t(45802));module.exports=a})();