"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},45802:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>v,requestAsyncStorage:()=>w,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{POST:()=>m});var n=r(49303),i=r(88716),s=r(60670),o=r(87070),u=r(20728),l=r(95456),p=r(91585),d=r(26033);let c=p.Ry({email:p.Z_().email(),password:p.Z_().min(1),twoFactorCode:p.Z_().optional()});async function m(e){try{let t=await e.json(),a=c.parse(t),n=await u._.user.findUnique({where:{email:a.email}});if(!n||!await (0,l.Oe)(a.password,n.passwordHash))return o.NextResponse.json({error:"Invalid email or password"},{status:401});if(n.twoFaEnabled){if(!a.twoFactorCode)return o.NextResponse.json({error:"Two-factor authentication required",requires2FA:!0},{status:403});let{verifyTwoFactorToken:e}=await Promise.all([r.e(748),r.e(423)]).then(r.bind(r,61423));if(!e(a.twoFactorCode,n.twoFaSecret))return o.NextResponse.json({error:"Invalid two-factor authentication code"},{status:401})}if(!n.isActivated)return o.NextResponse.json({error:"Account not activated. Please submit payment proof and wait for admin approval.",requiresActivation:!0,paymentStatus:n.paymentStatus},{status:403});await u._.user.update({where:{id:n.id},data:{lastLogin:new Date}});let i=(0,l.RA)({userId:n.id,email:n.email,username:n.username}),s=await u._.subscription.findUnique({where:{userId:n.id}});return o.NextResponse.json({message:"Login successful",token:i,user:{id:n.id,username:n.username,email:n.email,fullName:n.fullName,isVerified:n.isVerified,isActivated:n.isActivated,twoFaEnabled:n.twoFaEnabled,paymentStatus:n.paymentStatus,subscription:s?{plan:s.plan,status:s.status}:null}})}catch(e){if(console.error("Login error:",e),e instanceof d.jm)return o.NextResponse.json({error:"Invalid input data",details:e.errors},{status:400});return o.NextResponse.json({error:"Login failed. Please try again."},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/home/runner/work/AlgoEdge/AlgoEdge/src/app/api/auth/login/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:w,staticGenerationAsyncStorage:g,serverHooks:h}=f,x="/api/auth/login/route";function v(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},95456:(e,t,r)=>{r.d(t,{Oe:()=>f,RA:()=>d,VV:()=>w,WX:()=>c,c_:()=>m});var a=r(41482),n=r.n(a),i=r(42023),s=r.n(i),o=r(84770),u=r.n(o);let l=process.env.JWT_SECRET;l||console.warn("⚠️  JWT_SECRET not set. Using development fallback. DO NOT use in production!");let p=l||"dev-only-secret-DO-NOT-USE-IN-PRODUCTION";function d(e){return n().sign(e,p,{expiresIn:"7d"})}function c(e){try{return n().verify(e,p)}catch(e){return null}}async function m(e){let t=await s().genSalt(12);return s().hash(e,t)}async function f(e,t){return s().compare(e,t)}function w(e=32){return u().randomBytes(e).toString("hex")}},20728:(e,t,r)=>{r.d(t,{_:()=>n});let a=require("@prisma/client"),n=global.prisma||new a.PrismaClient({log:["error"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,972,944,585],()=>r(45802));module.exports=a})();