"use strict";(()=>{var e={};e.id=3002,e.ids=[3002],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},13143:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>w,staticGenerationAsyncStorage:()=>h});var a={};t.r(a),t.d(a,{POST:()=>m});var i=t(49303),s=t(88716),n=t(60670),o=t(87070),u=t(20728),l=t(95456),p=t(91585),d=t(26033);let c=p.Ry({firstName:p.Z_().min(1).max(50),lastName:p.Z_().min(1).max(50),email:p.Z_().email(),password:p.Z_().min(l.Z9),phone:p.Z_().optional(),country:p.Z_().optional()});async function m(e){try{let r=await e.json(),t=c.parse(r),a=`${t.firstName.toLowerCase()}${t.lastName.toLowerCase()}`.replace(/[^a-z0-9]/g,""),i=a,s=1;for(;await u._.user.findUnique({where:{username:i}});)i=`${a}${s}`,s++;if(await u._.user.findUnique({where:{email:t.email}}))return o.NextResponse.json({error:"Email already registered"},{status:400});let n=await (0,l.c_)(t.password),p=`${t.firstName} ${t.lastName}`,d=await u._.user.create({data:{username:i,email:t.email,passwordHash:n,fullName:p,phone:t.phone,country:t.country,isVerified:!1,approvalStatus:"pending"}});await u._.subscription.create({data:{userId:d.id,plan:"free",status:"active"}}),await u._.userSettings.create({data:{userId:d.id}});let m=(0,l.RA)({userId:d.id,email:d.email,username:d.username});return o.NextResponse.json({message:"Registration successful. Please verify your email with OTP.",token:m,user:{id:d.id,username:d.username,email:d.email,isVerified:d.isVerified,requiresOTP:!0}},{status:201})}catch(e){if(console.error("Registration error:",e),e instanceof d.jm)return o.NextResponse.json({error:"Invalid input data",details:e.errors},{status:400});return o.NextResponse.json({error:"Registration failed. Please try again."},{status:500})}}let f=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"/home/runner/work/AlgoEdge/AlgoEdge/src/app/api/auth/register/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:w}=f,x="/api/auth/register/route";function y(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:h})}},95456:(e,r,t)=>{t.d(r,{Oe:()=>w,RA:()=>f,VV:()=>x,WX:()=>g,Z9:()=>d,c_:()=>h,cq:()=>l,f:()=>y,sk:()=>p});var a=t(41482),i=t.n(a),s=t(42023),n=t.n(s),o=t(84770),u=t.n(o);let l=6,p=15,d=8,c=process.env.JWT_SECRET;c||console.warn("⚠️  JWT_SECRET not set. Using development fallback. DO NOT use in production!");let m=c||"dev-only-secret-DO-NOT-USE-IN-PRODUCTION";function f(e){return i().sign(e,m,{expiresIn:"7d"})}function g(e){try{return i().verify(e,m)}catch(e){return null}}async function h(e){let r=await n().genSalt(12);return n().hash(e,r)}async function w(e,r){return n().compare(e,r)}function x(e=32){return u().randomBytes(e).toString("hex")}function y(e=6){let r=Math.pow(10,e-1);return(r+u().randomBytes(4).readUInt32BE(0)%(Math.pow(10,e)-1-r+1)).toString()}},20728:(e,r,t)=>{t.d(r,{_:()=>i});let a=require("@prisma/client"),i=global.prisma||new a.PrismaClient({log:["error"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[8948,5972,6944,1585],()=>t(13143));module.exports=a})();